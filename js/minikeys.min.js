var MiniKeys=function(e){var t={};function o(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(r,s,function(t){return e[t]}.bind(null,s));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){"use strict";o.r(t);class r{constructor(){this._sampleNotes=new Array,this._noteBuffers=new Array,this._context=null,this._whiteKeys={a:60,s:62,d:64,f:65,g:67,h:69,j:71,k:72,l:74,";":76,"'":77},this._blackKeys={q:-1,w:61,e:63,r:-1,t:66,y:68,u:70,i:-1,o:73,p:75,"[":-1,"]":78},this._WHITEKEYSET=[21,23,24,26,28,29,31,33,35,36,38,40,41,43,45,47,48,50,52,53,55,57,59,60,62,64,65,67,69,71,72,74,76,77,79,81,83,84,86,88,89,91,93,95,96,98,100,101,103,105,107,108],this._BLACKKEYSET=[-1,22,-1,25,27,-1,30,32,34,-1,37,39,-1,42,44,46,-1,49,51,-1,54,56,58,-1,61,63,-1,66,68,70,-1,73,75,-1,78,80,82,-1,85,87,-1,90,92,94,-1,97,99,-1,102,104,106,-1,-1],this._keySetIndex=23,this.OCTAVE=7,this.TONE=1,this._volume=.9,this._compressorNode=null}}r.prototype.getWhiteMidiNotes=function(){return this._WHITEKEYSET},r.prototype.getBlackMidiNotes=function(){return this._BLACKKEYSET},r.prototype.getKeyIndex=function(){return this._keySetIndex},r.prototype.getKeys=function(){let e=[];return Object.keys(this._whiteKeys).forEach(t=>{e.push(t)}),Object.keys(this._blackKeys).forEach(t=>{-1!=this._blackKeys[t]&&e.push(t)}),e};var s=r;s.prototype.init=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,this._context=new AudioContext;let e=this._context;this._compressorNode=e.createDynamicsCompressor(),this._compressorNode.threshold.setValueAtTime(-12,e.currentTime),this._compressorNode.knee.setValueAtTime(0,e.currentTime),this._compressorNode.ratio.setValueAtTime(15,e.currentTime),this._compressorNode.attack.setValueAtTime(.005,e.currentTime),this._compressorNode.release.setValueAtTime(.05,e.currentTime),this._compressorNode.connect(e.destination)},s.prototype.loadSamples=function(e){let t=0;return new Promise((o,r)=>{const s=e.map((o,r)=>this._loadBuffer(o,r).then(o=>{this._sampleNotes[r]=o,this._sampleNotes.includes(o)||(this._sampleNotes[r]=o),t++;let s=new CustomEvent("sampleloaded",{detail:t/e.length});document.dispatchEvent(s)}));Promise.all(s).then(()=>{o(this._sampleNotes)}).catch(e=>r(e))})},s.prototype._loadBuffer=function(e,t){return new Promise((t,o)=>{const r=e.split("/").pop().split(".")[0];let s,n;if("p"==r.substring(0,1)||"f"==r.substring(0,1)?s=r.substring(0,1):o(Error("Invalid file name")),n=parseInt(r.substring(1)),n>=21&&n<=108){let s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer";let i=this;s.onload=function(){i._context.decodeAudioData(s.response,s=>{s?(i._noteBuffers[r]=s,t(n)):o(Error("error decoding file data: "+e))},(function(e){throw new Error(e)}))},s.onerror=function(){alert("BufferLoader: XHR error"),o(Error("BufferLoader: XHR error"))},s.send()}else o(Error("Invalid file name"))})},s.prototype.playNote=function(e,t,o=0){let r=null,s=null;t>=64&&t<=128?(r="f",s=((t-64)/256+.25)*this._volume):t>=0&&(r="p",s=t/256*this._volume);const n=this._sampleNotes.reduce((t,o)=>Math.abs(o-e)<Math.abs(t-e)?o:t,this._sampleNotes[0]);let i=this._context.createBufferSource();i.buffer=this._noteBuffers[r+n];const u=this._context.createGain();u.gain.value=s,i.connect(u),u.connect(this._compressorNode),i.playbackRate.value=2**((e-n)/12),i.start(0,o)},s.prototype.volume=function(e){if(e<0||e>1)throw new Error("volume must be between 0 and 1");this._volume=e,this._gainNode.gain.value=this._volume},s.prototype.shift=function(e,t=this.OCTAVE){if(1!=e&&-1!=e||t!=this.OCTAVE&&t!=this.TONE)throw new Error("shift must be 1 or -1 and step must be OCTAVE or TONE");this._keySetIndex+=e*t,this._keySetIndex<0?this._keySetIndex=0:this._keySetIndex+11>this._WHITEKEYSET.length&&(this._keySetIndex=this._WHITEKEYSET.length-11);let o=this._keySetIndex;Object.keys(this._whiteKeys).forEach(e=>{this._whiteKeys[e]=this._WHITEKEYSET[o],o++}),o=this._keySetIndex,Object.keys(this._blackKeys).forEach(e=>{this._blackKeys[e]=this._BLACKKEYSET[o],o++})};t.default=s}]).default;